
<section class="vs-event--page bg-color6 space z-index-common">
  <div class="vs-event--ele1">
    <img
      src="/assets/img/elements/events-page-ele1.png"
      alt="event page ele1"
    />
  </div>
  <div class="vs-event--ele2">
    <img
      src="/assets/img/elements/events-page-ele2.png"
      alt="event page ele1"
    />
  </div>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 mx-auto">
        <div class="vs-title text-center title-anime animation-style2">
          <div class="title-anime__wrap">
            <h5 class="vs-title__main">Scan Untuk Bermain!</h5>
            <span class="vs-title__sub">Boleh di sentuh atau tidak?</span>
          </div>
          <div class="vh-full p-3">
            <div class="card scanner-card bg-dark text-light">
              <div class="card-body p-0">
                <div class="col-12 g-0">
                  <div class="col-12">
                    <div id="reader" class="bg-black btn-area">
                      <div id="reader" class="bg-black position-relative"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  $(function () {
    const resultEl = $("#result");

    let html5QrCode = null;
    let camerasList = [];
    let currentCameraIndex = 0;

    function showResult(text) {
      resultEl.text(text || "-");
    }

    function handleError(err) {
      console.error(err);
      showResult("Error: " + (err?.message || err));
    }

    function isMobile() {
      return /Android|iPhone|iPad|iPod|Windows Phone/i.test(
        navigator.userAgent
      );
    }

    // ===========================
    // SCAN CAMERA LIST
    // ===========================
    function scanCameras() {
      Html5Qrcode.getCameras()
        .then((cams) => {
          camerasList = cams || [];
          // otomatis set kamera pertama + index
          currentCameraIndex = 0;
          startScanner();
        })
        .catch(handleError);
    }

    // ===========================
    // START SCANNER
    // ===========================
    async function startScanner() {
      try {
        const cameraId = camerasList[currentCameraIndex]?.id;
        if (!cameraId) return;

        if (html5QrCode) {
          await html5QrCode.stop();
          html5QrCode.clear();
        }

        html5QrCode = new Html5Qrcode("reader");

        const config = {
          fps: 10,
          qrbox: { width: 300, height: 300 },
          experimentalFeatures: { useBarCodeDetectorIfSupported: true },
        };

        await html5QrCode.start(
          cameraId,
          config,
          (decodedText) => showResult(decodedText),
          () => {}
        );
      } catch (e) {
        handleError(e);
      }
    }

    // ===========================
    // FLIP CAMERA (MOBILE ONLY)
    // ===========================
    console.log(isMobile(), "check")
if (isMobile()) {
  const flipBtn = $(`
    <button id="flipCameraBtn" 
      class="btn btn-outline-light position-absolute d-flex justify-content-center align-items-center"
      style="
        top: 10px;
        right: 10px;
        width: 45px;
        height: 45px;
        border-radius: 50%;
        backdrop-filter: blur(5px);
        background: rgba(255,255,255,0.15);
        z-index: 9999;
      ">
      <i class="bi bi-arrow-clockwise"></i>
    </button>
  `);

  $(".btn-area").append(flipBtn);

  flipBtn.on("click", function () {
    if (!camerasList.length) return;

    currentCameraIndex = (currentCameraIndex + 1) % camerasList.length;

    startScanner();
  });
}


    // INITIAL
    scanCameras();

    // refresh camera when back to tab
    document.addEventListener("visibilitychange", function () {
      if (document.visibilityState === "visible") scanCameras();
    });
  });
</script>
